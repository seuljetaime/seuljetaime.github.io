---
title: Java大量数据存储
tags:

---


# 数据库层面

1. 优化SQL、索引、SQL执行计划
2. 索引无效情况
3. 有时候SQL太复杂，或者需要计算时，可以拆分成多次查
4. 冗余字段
5. 定时生成报表表
6. 物化视图及定时更新
7. 分区、分表、分库



## 分区

对Java应用透明，只需修改SQL条件，让查询语句尽量定位到同个分区上或少量分区上。

[oracle表分区详解](http://blog.51cto.com/tianzt/171759)

[Oracle分区手册](https://docs.oracle.com/cd/E18283_01/server.112/e16541/toc.htm)

[oracle分区表执行计划](https://blog.csdn.net/gdmzlhj1/article/details/42001427)

[oracle分区技术提高查询效率](https://www.cnblogs.com/lm970585581/p/7874139.html)



## 分表、分库
[分库分表的几种常见形式以及可能遇到的难](https://www.infoq.cn/article/key-steps-and-likely-problems-of-split-table)

### 分表


```
create table t_order_2018 as select * from t_order where year = 2018;
create table t_order_2019 as select * from t_order where year = 2019;
```


分表后多张表在数据库层面是没有关联的，unique全局约束在数据库层面就会有问题。

需要使用中间件或者自行写插件的方法去修改原先的sql，让sql识别成分表名。



**手动分表参考链接**

[数据库分库分表策略的具体实现方案](https://blog.csdn.net/xlgen157387/article/details/53976153)

**中间件参考链接**
[轻量级数据库中间件利器Sharding-JDBC深度解析](https://www.sohu.com/a/160520991_411876)

[分库分表开源中间件之Sharding-JDBC使用体验](https://www.jianshu.com/p/2ca99c4e70c2)


### 分库

略



# 分布式缓存

1. 缓存常用且不怎么变的数据
2. 首页统计数据等数据，可以考虑不做实时统计，改为10～30定时更新到缓存

+ 单节点环境下可以缓存到Java中，需要处理读写锁。

+ 集群、分布式环境下，可以自己编写工具类将一些`非常慢查询、统计报表` 的结果缓存到数据库，但要额外编写逻辑处理：各种锁、time to live过期自动销毁、不同数据类型 等问题。有性能要求时，使用分布式缓存更好。

+ 推荐使用现成的分布式缓存，比如`redis`。分布式缓存基本都考虑了各种数据类型的存储、并发锁等问题，有现成的通用解决方案。



# 历史数据、日志

[elasticsearch百度百科](https://baike.baidu.com/item/elasticsearch/3411206?fr=aladdin)

> ElasticSearch是一个基于Lucene的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于[云计算](https://baike.baidu.com/item/%E4%BA%91%E8%AE%A1%E7%AE%97/9969353)中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。
>
> 我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用JSON通过HTTP来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多租户，我们希望建立一个云的解决方案。因此我们利用Elasticsearch来解决所有这些问题及可能出现的更多其它问题。